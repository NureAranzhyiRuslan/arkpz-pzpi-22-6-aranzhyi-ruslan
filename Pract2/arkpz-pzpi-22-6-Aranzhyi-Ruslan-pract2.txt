МІНІСТЕРСТВО ОСВІТИ І НАУКИ УКРАЇНИ

ХАРКІВСЬКИЙ НАЦІОНАЛЬНИЙ
УНІВЕРСИТЕТ РАДІОЕЛЕКТРОНІКИ



Практична робота №2


з дисципліни
«Аналіз та рефакторінг коду»






Харків 2024

1.1 Тема
Refactoring methods

1.2 Мета роботи
TODO: this

1.3 Хід роботи

1) Replace nested conditionals with guard clauses: (TODO: description).

Приклад до рефакторингу:
bool utl_Vector_equals(utl_Vector* a, utl_Vector* b) {
    if (a != b) {
        if (a->size == b->size) {
            if (a->message_def != NULL && b->message_def != NULL) {
                if (a->message_def == NULL || a->message_def->type == b->message_def->type) {
                    if (a->message_def == NULL || a->message_def->type != TLOBJECT || a->message_def->sub.type_def == b->message_def->sub.type_def) {
                        for (size_t i = 0; i < a->size; i++) {
                            void* value_a = a->items[i];
                            void* value_b = a->items[i];
                            switch (a->message_def->type) {
                                // Type-based checks
                            }
                        }
                    } else {
                        return false;
                    }
                } else {
                    return false;
                }
            } else {
                return false;
            }
        } else {
            return false;
        }
    } else {
        return true;
    }
    
    return true;
}

Приклад після рефакторингу:
bool utl_Vector_equals(utl_Vector* a, utl_Vector* b) {
    if(a == b) {
        return true;
    }
    if(a->size != b->size) {
        return false;
    }
    if(a->message_def == NULL || b->message_def == NULL) {
        return false;
    }
    if(a->message_def != NULL && a->message_def->type != b->message_def->type) {
        return false;
    }
    if(a->message_def != NULL && a->message_def->type == TLOBJECT && a->message_def->sub.type_def != b->message_def->sub.type_def) {
        return false;
    }

    for(size_t i = 0; i < a->size; i++) {
        void* value_a = a->items[i];
        void* value_b = a->items[i];
        switch (a->message_def->type) {
            // Type-based checks
        }
    }

    return true;
}

2) Replace Magic Number with Symbolic Constant: (TODO: description)

Приклад до рефакторингу:
@interactions.post("/<int:interaction>/<string:token>/callback", body_cls=InteractionRespond)
async def respond_to_interaction(data: InteractionRespond, interaction: Interaction = DepInteraction):
    d = data.data
    if interaction.status != 1:
        raise InteractionAlreadyAck
    if data.type == 4:
        if not d.content:
            raise CannotSendEmptyMessage
        await send_interaction_response(interaction, d.flags & 64, d.content)
    elif data.type == 5:
        flags = (d.flags & 64) if d is not None else 0
        await send_interaction_response(interaction, flags | 128, "")

    return "", 204

Приклад після рефакторингу:
@interactions.post("/<int:interaction>/<string:token>/callback", body_cls=InteractionRespond)
async def respond_to_interaction(data: InteractionRespond, interaction: Interaction = DepInteraction):
    T = InteractionCallbackType
    d = data.data
    if interaction.status != InteractionStatus.PENDING:
        raise InteractionAlreadyAck
    if data.type == T.CHANNEL_MESSAGE_WITH_SOURCE:
        if not d.content:
            raise CannotSendEmptyMessage
        flags = d.flags & MessageFlags.EPHEMERAL
        await send_interaction_response(interaction, flags, d.content)
    elif data.type == T.DEFFERED_CHANNEL_MESSAGE_WITH_SOURCE:
        flags = d.flags & MessageFlags.EPHEMERAL if d is not None else 0
        flags |= MessageFlags.LOADING
        await send_interaction_response(interaction, flags, "")

    return "", 204


3) Remove control flag: (TODO: description).

Приклад до рефакторингу:
// TODO: code

Приклад після рефакторингу:
// TODO: code


Основні переваги дотримання рекомендацій: 
TODO (?)

Висновки: (TODO: this).

Список використаних джерел:
1. TODO: refactoring methods book
